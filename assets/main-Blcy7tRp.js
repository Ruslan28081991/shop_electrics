var u=Object.defineProperty;var w=(r,e,t)=>e in r?u(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>(w(r,typeof e!="symbol"?e+"":e,t),t);import{F as N}from"./item.firebase-Ci3SnZzg.js";import{v as b}from"./v4-CQkTLCs1.js";class I{constructor({onNewProduct:e}){this.products=[],this.onNewProduct=e}add(e){const t={imgURL:e.imgURL,title:e.title,series:e.series,price:e.price,description:e.description,descriptionShort:e.descriptionShort,rating:e.rating,id:b()};return this.products.push(t),this.onNewProduct(this.products),t}get(){return this.products}set(e){this.products=e}}const E="/shop_electrics/basket.png",S="/shop_electrics/laptop.png";class _{constructor({onNewItem:e}){o(this,"handleNewItem",()=>{const e=`${S}`,t=this.inputTitle.value,i=this.inputSeries.value,s=this.inputPrice.value,n=this.intupDescriptionShort.value,c=this.inputDescription.value,a={imgURL:e,title:t,series:i,price:s,descriptionShort:n,description:c,rating:0};this.onNewItem(a)});o(this,"newWindow",e=>{window.location.href=`/shop_electrics/info.html?productId=${e.id}`});o(this,"addBag",e=>{this.addProductToLocalStorage(e),this.renderBagImages()});o(this,"openBag",()=>{window.location.href="/shop_electrics/bag.html"});this.porductsBox=document.querySelector(".products"),this.bagNode=document.querySelector(".bag"),this.bagBtnNode=document.querySelector(".bag_btn"),this.orderNode=document.querySelector(".order"),this.onNewItem=e,this.renderBagImages(),this.bagBtnNode.addEventListener("click",this.openBag)}render(e){this.porductsBox.innerHTML="",e.forEach(t=>{this.createProduct(t)})}createProduct(e){const t="$",i=document.createElement("li");i.className="item";const s=document.createElement("a");s.className="item_wrapper",s.addEventListener("click",()=>this.newWindow(e));const n=document.createElement("div");n.className="item_box";const c=document.createElement("img");c.className="item_img",c.src=e.imgURL;const a=document.createElement("h2");a.className="item_title",a.innerText=e.title;const m=document.createElement("p");m.className="item_series",m.innerText=e.series;const h=document.createElement("div");h.className="item_price_wrapper";const l=document.createElement("p");l.className="item_price",l.innerText=t+" "+e.price;const d=document.createElement("button");d.className="item_btn",d.addEventListener("click",()=>this.addBag(e));const p=document.createElement("img");p.className="item_btn_img",p.src=E,i.append(s,n,c,a,m,h,l,d,p),n.append(c),s.append(n,a,m),h.append(l,d),d.append(p),this.porductsBox.append(i)}addProductToLocalStorage(e){let t=JSON.parse(window.localStorage.getItem("bagProducts"))||[];const i=t.findIndex(s=>s.id===e.id);i!==-1?t[i].count+=1:t.push({id:e.id,count:1,img:e.imgURL,price:e.price}),window.localStorage.setItem("bagProducts",JSON.stringify(t))}imgWithLocalStorage(){return(JSON.parse(window.localStorage.getItem("bagProducts"))||[]).map(i=>i.img).filter(Boolean)}renderBagImages(){this.bagNode.innerHTML="",this.imgWithLocalStorage().forEach(t=>{const i=document.createElement("div");i.className="bag_envelope_img";const s=document.createElement("img");s.className="bag_img",s.src=t,this.bagNode.appendChild(i),i.append(s)})}renderOrders(e){this.orderNode.innerHTML="",e.forEach(t=>{this.orderNode.innerHTML+=`
                <p class="order_list">${t.id}</p>
            `})}}class f{constructor(){o(this,"handleModel",e=>{this.itemView.render(e)});o(this,"handleView",e=>{this.itemModel.add(e),this.firebase.add(e)});this.itemModel=new I({onNewProduct:this.handleModel}),this.itemView=new _({onNewItem:this.handleView}),this.firebase=new N}async pullFirebase(){try{const e=await this.firebase.pull();this.itemModel.set(e),this.itemView.render(this.itemModel.get())}catch(e){console.error("Ошибка при загрузке данных из Firebase:",e)}}async getOrder(){try{const e=await this.firebase.getOrder();this.itemView.renderOrders(e)}catch(e){console.error("Ошибка при загрузке данных из Firebase:",e)}}}const g=new f;g.pullFirebase();g.getOrder();
