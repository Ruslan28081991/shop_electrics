var p=Object.defineProperty;var P=(n,t,a)=>t in n?p(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a;var r=(n,t,a)=>(P(n,typeof t!="symbol"?t+"":t,a),a);import{F as _}from"./item.firebase-Ci3SnZzg.js";class w{constructor(){this.bagProducts=[]}getBag(){return this.bagProducts}}class N{constructor({onProductChange:t}){r(this,"_back",()=>{window.location.href="/shop_electrics/index.html"});r(this,"createProduct",t=>{const a="$",e=document.createElement("div");e.className="bag_container",e.dataset.id=t.id;const s=document.createElement("img");s.className="bag_image",s.src=`/shop_electrics/${t.imgURL}`;const c=document.createElement("p");c.className="bag_title",c.innerHTML=`${t.title}`;const o=document.createElement("p");o.className="bag_series",o.innerHTML=`${t.series}`;const l=document.createElement("div");l.className="bag_price_box";const g=document.createElement("p");g.className="bag_price",g.innerHTML=`${a} ${t.price} x ${t.count}`;const u=document.createElement("div");u.className="bag_count_box";const b=document.createElement("span");b.className="bag_count",b.innerHTML=`${t.count}`;const i=document.createElement("div");i.className="bag_count_minus",i.innerHTML="-",i.addEventListener("click",()=>{this.onProductChange(t.id,-1)});const d=document.createElement("div");d.className="bag_count_plus",d.innerHTML="+",d.addEventListener("click",()=>{this.onProductChange(t.id,1)});const m=document.createElement("p");m.className="bag_descr",m.innerHTML=`${t.descriptionShort}`;const h=document.createElement("div");h.className="rating",h.innerHTML=`
            <span class="star filled">&#9733</span>
            <span class="star filled">&#9733</span>
            <span class="star filled">&#9733</span>
            <span class="star filled">&#9733</span>
            <span class="star half-filled">&#9733</span>
            <span class="star filled">4.5 / 5</span>
        `,this.bagProductsNode.append(e),e.append(s,c,o,h,m,l),l.append(g,u),u.append(i,b,d)});this.backNode=document.querySelector(".back"),this.bagProductsNode=document.querySelector(".bag_products"),this.bagNode=document.querySelector(".bag"),this.bagSumNode=document.querySelector(".bag_sum"),this.bagBtnNode=document.querySelector(".bag_btn"),this.backNode.addEventListener("click",this._back),this.bagBtnNode.addEventListener("click",this._order),this.onProductChange=t,this.renderBagImages()}_order(){window.location.href="/shop_electrics/checkout.html"}renderBagImages(){this.bagNode.innerHTML="",this.imgWithLocalStorage().forEach(a=>{const e=document.createElement("img");e.className="bag_img",e.src=`/shop_electrics/${a}`,this.bagNode.appendChild(e)})}productsInLocalStorage(){return JSON.parse(window.localStorage.getItem("bagProducts"))||[]}imgWithLocalStorage(){return this.productsInLocalStorage().filter(e=>e.count>0).map(e=>e.img).filter(Boolean)}clearBag(){this.bagProductsNode.innerHTML=""}updateProductInView(t,a){const e=this.bagProductsNode.querySelector(`.bag_container[data-id="${t}"]`),s=e==null?void 0:e.querySelector(".bag_count"),c=e==null?void 0:e.querySelector(".bag_price");if(e&&s&&c)if(a>0){s.innerHTML=a;const o=c.innerHTML.split(" x ")[0];c.innerHTML=`${o} x ${a}`}else e.remove();else console.error("Product element not found in DOM:",t)}}class f{constructor(){r(this,"handleProductChange",(t,a)=>{let e=JSON.parse(window.localStorage.getItem("bagProducts"))||[];const s=e.findIndex(c=>c.id===t);s!==-1?(e[s].count+=a,e[s].count<=0?(e.splice(s,1),this.bagView.updateProductInView(t,0)):this.bagView.updateProductInView(t,e[s].count),window.localStorage.setItem("bagProducts",JSON.stringify(e)),e.length===0&&(this.bagView.clearBag(),window.localStorage.clear("bagProducts"),this.bagView.bagProductsNode.innerHTML="<p class='bag_products_text'>Корзина пуста</p>"),this.bagView.productsInLocalStorage(),this.bagView.renderBagImages(),this.handlePriceProducts()):console.error("Product not found in cart:",t)});r(this,"handlePriceProducts",()=>{const t=this.bagView.productsInLocalStorage();let a=0;t.forEach(e=>{a+=e.price*e.count}),this.bagView.bagSumNode.innerHTML=`Сумма $${a.toFixed(2)}`});this.bagModel=new w,this.bagView=new N({onProductChange:this.handleProductChange}),this.firebase=new _,this.displayCart(),this.handlePriceProducts()}async loadProduct(t,a){try{const e=await this.firebase.getProductId(t);e?(e.count=a,this.bagView.createProduct(e)):console.error("Товар не найден")}catch(e){console.error("Ошибка при загрузке данных о товаре:",e)}}async displayCart(){const t=JSON.parse(window.localStorage.getItem("bagProducts"))||[];t.length>=1&&(this.bagView.bagProductsNode.innerHTML="<p class='bag_products_text'>Проверь корзину</p>");for(const{id:a,count:e}of t)await this.loadProduct(a,e);t.length===0&&(this.bagView.bagProductsNode.innerHTML="<p class='bag_products_text'>Корзина пуста</p>")}}new f;
